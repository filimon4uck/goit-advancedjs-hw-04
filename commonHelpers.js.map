{"version":3,"file":"commonHelpers.js","sources":["../src/api_search.js","../src/markup.js","../src/index.js"],"sourcesContent":["import axios from 'axios';\nexport async function serviceSearch(requestValue, page = 1) {\n  const url = 'https://pixabay.com/api/';\n  const param = new URLSearchParams({\n    key: '40878380-6ee06a62f90a8337fbd0b4096',\n    q: requestValue,\n    image_type: 'photo',\n    orientation: 'horizontal',\n    safesearch: true,\n    page,\n    per_page: 40,\n  });\n  console.log(page);\n  const response = await axios.get(`${url}?${param}`);\n  if (response.data.totalHits === 0) {\n    throw new Error(\n      'Sorry, there are no images matching your search query. Please try again.'\n    );\n  }\n  return response.data;\n}\n","export async function createMarkup(data) {\n  return data.hits\n    .map(\n      ({\n        webformatURL,\n        largeImageURL,\n        tags,\n        likes,\n        views,\n        comments,\n        downloads,\n      }) => `<div class=\"photo-card\">\n    <a href=\"${largeImageURL}\"><img src=\"${webformatURL}\" alt=\"${tags}\" loading=\"lazy\" /></a>\n    <div class=\"info\">\n        <p class=\"info-item\">\n            <b>Likes</b><br>\n            ${likes}\n        </p>\n            <p class=\"info-item\">\n        <b>Views</b><br>\n         ${views}\n        </p>\n        <p class=\"info-item\">\n            <b>Comments</b><br>\n            ${comments}\n        </p>\n        <p class=\"info-item\">\n            <b>Downloads</b><br>\n            ${downloads}\n        </p>\n    </div>\n</div>`\n    )\n    .join('');\n}\n","import { serviceSearch } from './api_search';\nimport iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\nimport SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\nimport { createMarkup } from './markup.js';\nlet lightbox;\nconst elements = {\n  searchForm: document.querySelector('.search-form'),\n  gallery: document.querySelector('.gallery'),\n  js_guard: document.querySelector('.js-guarg'),\n};\n\nlet page = 1;\nlet value = '';\n\nlet options = {\n  root: null,\n  rootMargin: '300px',\n  threshold: 0,\n};\nconst observer = new IntersectionObserver(loadMoreHandler, options);\n\nelements.searchForm.addEventListener('submit', searchHandler);\nasync function searchHandler(evt) {\n  evt.preventDefault();\n  const searchValue = evt.currentTarget.elements.searchQuery.value;\n  if (searchValue.trim() === '') {\n    return;\n  }\n  if (value !== searchValue) {\n    value = searchValue;\n  }\n  page = 1;\n  try {\n    const data = await serviceSearch(searchValue, page);\n    page += 1;\n    elements.gallery.innerHTML = await createMarkup(data);\n    iziToast.info({\n      message: `Hooray! We found ${data.totalHits} images.`,\n      position: 'topRight',\n    });\n    observer.observe(elements.js_guard);\n  } catch (error) {\n    console.log(error);\n    elements.gallery.innerHTML = '';\n    observer.unobserve(elements.js_guard);\n    iziToast.error({\n      message:\n        'Sorry, there are no images matching your search query. Please try again.',\n      position: 'topRight',\n    });\n  }\n  lightbox = new SimpleLightbox('.gallery a');\n}\n\nasync function loadMoreHandler(entries) {\n  for (const entry of entries) {\n    if (entry.isIntersecting) {\n      try {\n        const data = await serviceSearch(value, page);\n        const imagesOfOnePage = page * 40;\n        if (imagesOfOnePage >= data.totalHits) {\n          console.log(data);\n          console.log(imagesOfOnePage);\n          observer.unobserve(elements.js_guard);\n          throw new Error(\n            \"We're sorry, but you've reached the end of search results.\"\n          );\n        }\n        elements.gallery.insertAdjacentHTML(\n          'beforeend',\n          await createMarkup(data)\n        );\n        page += 1;\n        lightbox.refresh();\n      } catch (error) {\n        iziToast.error({\n          message: \"We're sorry, but you've reached the end of search results.\",\n          position: 'topRight',\n        });\n        console.log(error);\n      }\n    }\n  }\n}\n"],"names":["serviceSearch","requestValue","page","url","param","response","axios","createMarkup","data","webformatURL","largeImageURL","tags","likes","views","comments","downloads","lightbox","elements","value","options","observer","loadMoreHandler","searchHandler","evt","searchValue","iziToast","error","SimpleLightbox","entries","entry","imagesOfOnePage"],"mappings":"owBACO,eAAeA,EAAcC,EAAcC,EAAO,EAAG,CAC1D,MAAMC,EAAM,2BACNC,EAAQ,IAAI,gBAAgB,CAChC,IAAK,qCACL,EAAGH,EACH,WAAY,QACZ,YAAa,aACb,WAAY,GACZ,KAAAC,EACA,SAAU,EACd,CAAG,EACD,QAAQ,IAAIA,CAAI,EAChB,MAAMG,EAAW,MAAMC,EAAM,IAAI,GAAGH,KAAOC,GAAO,EAClD,GAAIC,EAAS,KAAK,YAAc,EAC9B,MAAM,IAAI,MACR,0EACN,EAEE,OAAOA,EAAS,IAClB,CCpBO,eAAeE,EAAaC,EAAM,CACvC,OAAOA,EAAK,KACT,IACC,CAAC,CACC,aAAAC,EACA,cAAAC,EACA,KAAAC,EACA,MAAAC,EACA,MAAAC,EACA,SAAAC,EACA,UAAAC,CACR,IAAY;AAAA,eACGL,gBAA4BD,WAAsBE;AAAA;AAAA;AAAA;AAAA,cAInDC;AAAA;AAAA;AAAA;AAAA,WAIHC;AAAA;AAAA;AAAA;AAAA,cAIGC;AAAA;AAAA;AAAA;AAAA,cAIAC;AAAA;AAAA;AAAA,OAIT,EACA,KAAK,EAAE,CACZ,CC5BA,IAAIC,EACJ,MAAMC,EAAW,CACf,WAAY,SAAS,cAAc,cAAc,EACjD,QAAS,SAAS,cAAc,UAAU,EAC1C,SAAU,SAAS,cAAc,WAAW,CAC9C,EAEA,IAAIf,EAAO,EACPgB,EAAQ,GAERC,EAAU,CACZ,KAAM,KACN,WAAY,QACZ,UAAW,CACb,EACA,MAAMC,EAAW,IAAI,qBAAqBC,EAAiBF,CAAO,EAElEF,EAAS,WAAW,iBAAiB,SAAUK,CAAa,EAC5D,eAAeA,EAAcC,EAAK,CAChCA,EAAI,eAAc,EAClB,MAAMC,EAAcD,EAAI,cAAc,SAAS,YAAY,MAC3D,GAAIC,EAAY,KAAM,IAAK,GAG3B,CAAIN,IAAUM,IACZN,EAAQM,GAEVtB,EAAO,EACP,GAAI,CACF,MAAMM,EAAO,MAAMR,EAAcwB,EAAatB,CAAI,EAClDA,GAAQ,EACRe,EAAS,QAAQ,UAAY,MAAMV,EAAaC,CAAI,EACpDiB,EAAS,KAAK,CACZ,QAAS,oBAAoBjB,EAAK,oBAClC,SAAU,UAChB,CAAK,EACDY,EAAS,QAAQH,EAAS,QAAQ,CACnC,OAAQS,EAAP,CACA,QAAQ,IAAIA,CAAK,EACjBT,EAAS,QAAQ,UAAY,GAC7BG,EAAS,UAAUH,EAAS,QAAQ,EACpCQ,EAAS,MAAM,CACb,QACE,2EACF,SAAU,UAChB,CAAK,CACF,CACDT,EAAW,IAAIW,EAAe,YAAY,EAC5C,CAEA,eAAeN,EAAgBO,EAAS,CACtC,UAAWC,KAASD,EAClB,GAAIC,EAAM,eACR,GAAI,CACF,MAAMrB,EAAO,MAAMR,EAAckB,EAAOhB,CAAI,EACtC4B,EAAkB5B,EAAO,GAC/B,GAAI4B,GAAmBtB,EAAK,UAC1B,cAAQ,IAAIA,CAAI,EAChB,QAAQ,IAAIsB,CAAe,EAC3BV,EAAS,UAAUH,EAAS,QAAQ,EAC9B,IAAI,MACR,4DACZ,EAEQA,EAAS,QAAQ,mBACf,YACA,MAAMV,EAAaC,CAAI,CACjC,EACQN,GAAQ,EACRc,EAAS,QAAO,CACjB,OAAQU,EAAP,CACAD,EAAS,MAAM,CACb,QAAS,6DACT,SAAU,UACpB,CAAS,EACD,QAAQ,IAAIC,CAAK,CAClB,CAGP"}